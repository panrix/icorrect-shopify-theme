{{ 'section-contact-form.css' | asset_url | stylesheet_tag }}

{%- style -%}
  .contact-section-{{ section.id }}{
    font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    width: 100%;
    background-color: {{ section.settings.section_bg }};
    color: {{ section.settings.text_color }};
    padding: 60px 20px;
  }

  .contact-wrapper{
    max-width: 1400px; 
    margin: 0 auto;
    display:flex;
    flex-direction:column;
    width:100%;
    min-height: auto;
    gap: 40px;
  }
  
  .contact-form-panel { order: 1; }
  .contact-info-panel { order: 2; }
  
  @media screen and (min-width: 990px){
    .contact-wrapper{ flex-direction:row; align-items: flex-start; gap: 60px; }
    .contact-info-panel{ width: 50%; order: 1; }
    .contact-form-panel{ width: 50%; padding-top: 10px; order: 2; }
  }

  .contact-info-panel{
    background-color: transparent; 
    display:flex;
    flex-direction:column;
    gap: 24px;
  }

  .contact-map-wrapper {
    width: 100%;
    height: 300px;
    border-radius: 8px;
    overflow: hidden;
    border: 1px solid {{ section.settings.input_border }};
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
  }
  
  @media screen and (min-width: 990px){
    .contact-map-wrapper { height: auto; aspect-ratio: 1 / 1; }
  }

  .contact-map-wrapper iframe { width: 100%; height: 100%; border: 0; display: block; }

  .contact-details-card {
    display: grid;
    grid-template-columns: 1fr;
    background-color: #ffffff;
    border: 1px solid {{ section.settings.input_border }};
    border-radius: 12px;
    overflow: hidden;
    margin-top: 10px;
  }

  .contact-details-col {
    padding: 24px;
    display: flex;
    flex-direction: column;
    gap: 12px;
  }

  .contact-details-col:not(:last-child) {
    border-bottom: 1px solid {{ section.settings.input_border }};
  }

  @media screen and (min-width: 600px){
    .contact-details-card { grid-template-columns: 1fr 1fr; align-items: stretch; }
    .contact-details-col:not(:last-child) { border-bottom: none; border-right: 1px solid {{ section.settings.input_border }}; }
  }

  .contact-detail-label{
    font-size: 11px;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    color: {{ section.settings.muted_text_color }};
    margin: 0;
    display: flex;
    align-items: center;
    gap: 8px;
  }
  
  .contact-detail-label svg { width: 16px; height: 16px; color: {{ section.settings.accent_color }}; }

  .contact-detail-value{
    color: {{ section.settings.text_color }};
    font-size: 15px;
    font-weight: 500;
    line-height: 1.6;
    margin:0;
    text-decoration:none;
    display: block; 
  }

  .hours-grid {
    display: grid;
    grid-template-columns: 90px 1fr;
    gap: 6px 10px;
    font-size: 14px;
    font-weight: 500;
    color: {{ section.settings.text_color }};
  }
  .hours-day { color: {{ section.settings.muted_text_color }}; }
  .hours-time { text-align: left; }

  .contact-form-panel{
    flex:1;
    display:flex;
    flex-direction: column;
    background-color: transparent; 
  }

  .contact-form-container{ width:100%; }

  .contact-form-heading{
    font-size: 32px;
    font-weight: 700;
    line-height: 1.2;
    margin:0 0 12px 0;
    letter-spacing: -0.01em;
  }

  .contact-form-subtext{
    font-size: 15px;
    font-weight: 400;
    color: {{ section.settings.muted_text_color }};
    margin:0 0 32px 0;
    line-height: 1.6;
  }
  .required-indicator{ color:#ef4444; margin-left:2px; }

  .contact-fields-row{
    display:grid;
    grid-template-columns: 1fr;
    gap: 20px;
    margin-bottom: 20px;
  }
  @media screen and (min-width: 750px){
    .contact-fields-row{ grid-template-columns: 1fr 1fr; }
  }

  .contact-field{ margin-bottom: 20px; }

  .contact-field-label{
    display:block;
    font-size: 11px;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    color: {{ section.settings.muted_text_color }};
    margin-bottom: 8px;
  }

  .contact-field-input, .contact-field-select {
    width:100%;
    height: 52px;
    padding: 0 16px;
    font-size: 15px;
    color: {{ section.settings.text_color }};
    background-color: #ffffff;
    border: 1px solid {{ section.settings.input_border }};
    border-radius: 8px;
    transition: all .2s ease;
    font-family: inherit;
    appearance: none;
  }
  .contact-field-input:focus, .contact-field-select:focus{
    outline:none;
    border-color: {{ section.settings.accent_color }};
    box-shadow: 0 0 0 1px {{ section.settings.accent_color }};
  }
  
  .contact-field-select {
    background-image: url("data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%23999%22%20d%3D%22M287%2069.4a17.6%2017.6%200%200%200-13-5.4H18.4c-5%200-9.3%201.8-12.9%205.4A17.6%2017.6%200%200%200%200%2082.2c0%205%201.8%209.3%205.4%2012.9l128%20127.9c3.6%203.6%207.8%205.4%2012.8%205.4s9.2-1.8%2012.8-5.4L287%2095c3.5-3.5%205.4-7.8%205.4-12.8%200-5-1.9-9.2-5.5-12.8z%22%2F%3E%3C%2Fsvg%3E");
    background-repeat: no-repeat;
    background-position: right 16px top 50%;
    background-size: 10px auto;
  }

  .contact-field-textarea{
    width:100%;
    min-height: 160px;
    padding: 14px 16px;
    font-size: 15px;
    color: {{ section.settings.text_color }};
    background-color: #ffffff;
    border: 1px solid {{ section.settings.input_border }};
    border-radius: 8px;
    transition: all .2s ease;
    font-family: inherit;
    resize: vertical;
    line-height: 1.5;
  }
  .contact-field-textarea:focus{
    outline:none;
    border-color: {{ section.settings.accent_color }};
    box-shadow: 0 0 0 1px {{ section.settings.accent_color }};
  }

  .device-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 12px;
    margin-bottom: 24px;
  }
  @media(min-width: 600px) {
    .device-grid { grid-template-columns: repeat(4, 1fr); }
  }

  .device-radio-input { display: none; }

  .device-card {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    background: #ffffff;
    border: 1px solid {{ section.settings.input_border }};
    border-radius: 12px;
    padding: 16px 8px;
    cursor: pointer;
    transition: all .2s ease;
    text-align: center;
    height: 100%;
  }
  .device-card:hover {
    border-color: {{ section.settings.accent_color }};
    background-color: #f9fafb;
  }
  
  .device-radio-input:checked + .device-card {
    border-color: {{ section.settings.accent_color }};
    box-shadow: 0 0 0 1px {{ section.settings.accent_color }};
    background-color: #f0f9ff;
  }

  .device-icon { width: 32px; height: 32px; margin-bottom: 10px; object-fit: contain; }
  .device-name { font-size: 13px; font-weight: 600; color: {{ section.settings.text_color }}; }

  .contact-submit-btn{
    display:inline-flex;
    align-items:center;
    justify-content:center;
    padding: 12px 32px;
    font-size: 15px;
    font-weight: 600;
    color:#fff;
    background-color: #1f2937;
    border:none;
    border-radius: 6px;
    cursor:pointer;
    transition: background-color .2s ease;
    font-family: inherit;
    min-width: 140px;
    height: 46px;
    margin-top: 10px;
  }
  .contact-submit-btn:hover{ background-color: #111827; }

  .contact-success-message{ text-align:center; padding: 56px 24px; }
  .contact-error-banner{
    padding: 14px 16px;
    background-color:#fef2f2;
    border-radius: 8px;
    margin-bottom: 20px;
    color:#b91c1c;
  }
  
  optgroup { font-weight: 700; color: #333; }
  option { font-weight: 400; color: #000; padding: 5px;}

  #repairSuggestion {
    margin-bottom: 20px;
    overflow: hidden;
    max-height: 0;
    opacity: 0;
    transition: max-height 0.4s ease, opacity 0.3s ease, margin 0.3s ease;
  }
  #repairSuggestion.visible {
    max-height: 600px;
    opacity: 1;
  }

  .suggestion-card {
    background: #ffffff;
    border: 1px solid {{ section.settings.input_border }};
    border-radius: 12px;
    overflow: hidden;
  }

  .suggestion-header {
    padding: 12px 16px;
    background: #f0f9ff;
    border-bottom: 1px solid {{ section.settings.input_border }};
    display: flex;
    align-items: center;
    gap: 8px;
  }
  .suggestion-header svg { width: 16px; height: 16px; color: {{ section.settings.accent_color }}; flex-shrink: 0; }
  .suggestion-header-text {
    font-size: 11px;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.08em;
    color: {{ section.settings.muted_text_color }};
  }

  .suggestion-link {
    display: flex;
    align-items: center;
    padding: 16px;
    text-decoration: none;
    color: {{ section.settings.text_color }};
    transition: background .15s ease;
    gap: 14px;
    border-bottom: 1px solid {{ section.settings.input_border }};
  }
  .suggestion-link:hover { background: #f9fafb; }

  .suggestion-icon-wrap {
    width: 40px;
    height: 40px;
    background: #eff6ff;
    border-radius: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
  }
  .suggestion-icon-wrap svg { width: 20px; height: 20px; color: {{ section.settings.accent_color }}; }

  .suggestion-body { flex: 1; min-width: 0; }
  .suggestion-title { font-size: 15px; font-weight: 600; color: {{ section.settings.text_color }}; margin-bottom: 2px; }
  .suggestion-meta { font-size: 13px; color: {{ section.settings.muted_text_color }}; }
  .suggestion-arrow { width: 20px; height: 20px; color: {{ section.settings.accent_color }}; flex-shrink: 0; }

  .service-toggle {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 6px;
    padding: 12px 16px;
    background: #f9fafb;
    border: none;
    border-bottom: 1px solid {{ section.settings.input_border }};
    cursor: pointer;
    width: 100%;
    font-family: inherit;
    font-size: 12px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    color: {{ section.settings.muted_text_color }};
    transition: background-color 0.2s;
  }
  .service-toggle:hover { background: #f3f4f6; }
  .service-toggle svg { width: 14px; height: 14px; transition: transform 0.2s; }
  .service-toggle.collapsed svg { transform: rotate(180deg); }

  .service-content { padding: 16px 20px; }
  .service-content.hidden { display: none; }

  .service-row { display: flex; align-items: center; padding: 8px 0; }
  .service-row:first-child { padding-top: 0; }
  .service-row:last-child { padding-bottom: 0; }

  .service-row-icon {
    width: 24px;
    height: 24px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: {{ section.settings.accent_color }};
    margin-right: 12px;
    flex-shrink: 0;
  }
  .service-row-icon svg { width: 18px; height: 18px; }

  .service-row-label {
    width: 100px;
    font-size: 14px;
    font-weight: 500;
    color: {{ section.settings.muted_text_color }};
    flex-shrink: 0;
  }

  .service-row-value {
    font-size: 14px;
    font-weight: 600;
    color: {{ section.settings.text_color }};
  }

  @media (max-width: 500px) {
    .service-row-label { width: 85px; font-size: 13px; }
    .service-row-value { font-size: 13px; }
  }
{%- endstyle -%}

<div class="contact-section-{{ section.id }}">
  <div class="contact-wrapper">
    
    <div class="contact-info-panel">
      <div class="contact-map-wrapper">
        {%- if section.settings.map_html != blank -%}
           {{ section.settings.map_html }}
        {%- else -%}
           <div style="width:100%;height:100%;background:#eee;display:flex;align-items:center;justify-content:center;color:#666;">
             Map Embed Missing
           </div>
        {%- endif -%}
      </div>

      <div class="contact-details-card">
        <div class="contact-details-col">
          {%- if section.settings.address != blank -%}
             <p class="contact-detail-label">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M15 10.5a3 3 0 11-6 0 3 3 0 016 0z" /><path stroke-linecap="round" stroke-linejoin="round" d="M19.5 10.5c0 7.142-7.5 11.25-7.5 11.25S4.5 17.642 4.5 10.5a7.5 7.5 0 1115 0z" /></svg>
                ADDRESS
             </p>
             <p class="contact-detail-value">{{ section.settings.address | newline_to_br }}</p>
          {%- endif -%}
        </div>

        <div class="contact-details-col">
          <p class="contact-detail-label">
             <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M12 6v6h4.5m4.5 0a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
             OPENING HOURS
          </p>
          <div class="hours-grid">
            <span class="hours-day">Monday:</span> <span class="hours-time">9am - 6pm</span>
            <span class="hours-day">Tuesday:</span> <span class="hours-time">9am - 6pm</span>
            <span class="hours-day">Wednesday:</span> <span class="hours-time">9am - 6pm</span>
            <span class="hours-day">Thursday:</span> <span class="hours-time">9am - 6pm</span>
            <span class="hours-day">Friday:</span> <span class="hours-time">10am - 6pm</span>
            <span class="hours-day">Saturday:</span> <span class="hours-time">Closed</span>
            <span class="hours-day">Sunday:</span> <span class="hours-time">Closed</span>
          </div>
        </div>
      </div>
    </div>

    <div class="contact-form-panel">
      <div class="contact-form-container">
        {%- form 'contact', id: 'ContactForm' -%}
          {%- if form.posted_successfully? -%}
            <div class="contact-success-message">
              <h2 style="font-size:24px; font-weight:700; margin-bottom:10px;">Message Sent!</h2>
              <p style="color:{{ section.settings.muted_text_color }}">We'll get back to you shortly with your quote.</p>
            </div>
          {%- else -%}
            
            {%- if template.suffix == 'contact' -%}
              <h1 class="contact-form-heading">{{ section.settings.form_heading }}</h1>
            {%- else -%}
              <h2 class="contact-form-heading">{{ section.settings.form_heading }}</h2>
            {%- endif -%}
            <p class="contact-form-subtext">
              {{ section.settings.form_subtitle }}<br>
              Fields marked with <span class="required-indicator">*</span> are required
            </p>

            {%- if form.errors -%}
              <div class="contact-error-banner">
                <p>Please check the fields and try again.</p>
              </div>
            {%- endif -%}

            <div class="contact-fields-row">
              <div style="margin-bottom:0;">
                <label class="contact-field-label" for="ContactForm-name">NAME<span class="required-indicator">*</span></label>
                <input class="contact-field-input" type="text" id="ContactForm-name" name="contact[name]" value="{% if form.name %}{{ form.name }}{% elsif customer %}{{ customer.name }}{% endif %}" placeholder="Your full name" required>
              </div>
              <div style="margin-bottom:0;">
                <label class="contact-field-label" for="ContactForm-email">EMAIL<span class="required-indicator">*</span></label>
                <input class="contact-field-input" type="email" id="ContactForm-email" name="contact[email]" value="{% if form.email %}{{ form.email }}{% elsif customer %}{{ customer.email }}{% endif %}" placeholder="your@email.com" required>
              </div>
            </div>

            <div class="contact-field">
              <label class="contact-field-label" for="ContactForm-phone">PHONE NUMBER<span class="required-indicator">*</span></label>
              <input class="contact-field-input" type="tel" id="ContactForm-phone" name="contact[phone]" value="{% if form.phone %}{{ form.phone }}{% elsif customer %}{{ customer.phone }}{% endif %}" placeholder="+44 (0)000 000 0000" required>
            </div>

            <div class="contact-field">
              <label class="contact-field-label">SELECT DEVICE<span class="required-indicator">*</span></label>
              <div class="device-grid">
                <label>
                  <input type="radio" name="contact[device_type]" value="macbook" class="device-radio-input" onchange="updateModels(this.value)" required>
                  <div class="device-card">
                    <img src="https://cdn.shopify.com/s/files/1/0728/7111/7053/files/computer_1.png?v=1766439002" alt="MacBook" class="device-icon">
                    <span class="device-name">MacBook</span>
                  </div>
                </label>

                <label>
                  <input type="radio" name="contact[device_type]" value="iphone" class="device-radio-input" onchange="updateModels(this.value)">
                  <div class="device-card">
                    <img src="https://cdn.shopify.com/s/files/1/0728/7111/7053/files/smartphone.png?v=1766439001" alt="iPhone" class="device-icon">
                    <span class="device-name">iPhone</span>
                  </div>
                </label>

                <label>
                  <input type="radio" name="contact[device_type]" value="ipad" class="device-radio-input" onchange="updateModels(this.value)">
                  <div class="device-card">
                    <img src="https://cdn.shopify.com/s/files/1/0728/7111/7053/files/ipad.png?v=1766439002" alt="iPad" class="device-icon">
                    <span class="device-name">iPad</span>
                  </div>
                </label>

                <label>
                  <input type="radio" name="contact[device_type]" value="watch" class="device-radio-input" onchange="updateModels(this.value)">
                  <div class="device-card">
                    <img src="https://cdn.shopify.com/s/files/1/0728/7111/7053/files/apple.png?v=1766439001" alt="Apple Watch" class="device-icon">
                    <span class="device-name">Watch</span>
                  </div>
                </label>
              </div>
            </div>

            <div class="contact-fields-row">
              <div style="margin-bottom:0;">
                <label class="contact-field-label" for="ContactForm-model">MODEL<span class="required-indicator">*</span></label>
                <select class="contact-field-select" id="ContactForm-model" name="contact[device_model]" required disabled onchange="updateSuggestion()">
                  <option value="" disabled selected>Select Model...</option>
                </select>
              </div>
              <div style="margin-bottom:0;">
                <label class="contact-field-label" for="ContactForm-fault">FAULT CATEGORY<span class="required-indicator">*</span></label>
                <select class="contact-field-select" id="ContactForm-fault" name="contact[fault_area]" required disabled onchange="updateSuggestion()">
                  <option value="" disabled selected>Select device first...</option>
                </select>
              </div>
            </div>

            <!-- Repair Suggestion Card -->
            <div id="repairSuggestion"></div>

            <div class="contact-field">
              <label class="contact-field-label" for="ContactForm-body">YOUR QUESTION<span class="required-indicator">*</span></label>
              <textarea class="contact-field-textarea" id="ContactForm-body" name="contact[body]" placeholder="Tell us about your device repair needs..." required>{{ form.body }}</textarea>
            </div>

            <button type="submit" class="contact-submit-btn">Send</button>
          {%- endif -%}
        {%- endform -%}
      </div>
    </div>
  </div>
</div>

<script>
  /* ============================================ */
  /* DATA MODELS                                  */
  /* ============================================ */
  var repairData = {
    macbook: {
      "MacBook Pro": [
        "MacBook Pro 16-inch 'M4 Pro/Max' A3186/A3403 (2024)",
        "MacBook Pro 16-inch 'M3 Pro/Max' A2991 (2023)",
        "MacBook Pro 16-inch 'M2 Pro/Max' A2780 (2023)",
        "MacBook Pro 16-inch 'M1 Pro/Max' A2485 (2021)",
        "MacBook Pro 16-inch A2141 (2019)",
        "MacBook Pro 15-inch A1990 (2018-2019)",
        "MacBook Pro 15-inch A1707 (2016-2017)",
        "MacBook Pro 14-inch 'M4 Pro/Max' A3112/A3185/A3401 (2024)",
        "MacBook Pro 14-inch 'M3 Pro/Max' A2918/A2992 (2023)",
        "MacBook Pro 14-inch 'M2 Pro/Max' A2779 (2023)",
        "MacBook Pro 14-inch 'M1 Pro/Max' A2442 (2021)",
        "MacBook Pro 13-inch 'M2' A2338 (2022)",
        "MacBook Pro 13-inch 'M1' A2338 (2020)",
        "MacBook Pro 13-inch A2251 (2020)",
        "MacBook Pro 13-inch A2289 (2020)",
        "MacBook Pro 13-inch A2159 (2019)",
        "MacBook Pro 13-inch A1989 (2018-2019)"
      ],
      "MacBook Air": [
        "MacBook Air 15-inch 'M4' A3241 (2025)",
        "MacBook Air 15-inch 'M3' A3114 (2024)",
        "MacBook Air 15-inch 'M2' A2941 (2023)",
        "MacBook Air 13-inch 'M4' A3240 (2025)",
        "MacBook Air 13-inch 'M3' A3113 (2024)",
        "MacBook Air 13-inch 'M2' A2681 (2022)",
        "MacBook Air 13-inch 'M1' A2337 (2020)",
        "MacBook Air 13-inch A2179 (2020)",
        "MacBook Air 13-inch A1932 (2018-2019)"
      ]
    },
    iphone: [
      "iPhone 16 Pro Max", "iPhone 16 Pro", "iPhone 16 Plus", "iPhone 16", "iPhone 16e",
      "iPhone 15 Pro Max", "iPhone 15 Pro", "iPhone 15 Plus", "iPhone 15",
      "iPhone 14 Pro Max", "iPhone 14 Pro", "iPhone 14 Plus", "iPhone 14",
      "iPhone SE 3rd Gen (2022)",
      "iPhone 13 Pro Max", "iPhone 13 Pro", "iPhone 13", "iPhone 13 Mini",
      "iPhone 12 Pro Max", "iPhone 12 Pro", "iPhone 12", "iPhone 12 Mini",
      "iPhone SE 2nd Gen (2020)",
      "iPhone 11 Pro Max", "iPhone 11 Pro", "iPhone 11"
    ],
    ipad: {
      "iPad Pro": [
        "iPad Pro 13 M4 (2024)", "iPad Pro 12.9 6th Gen M2 (2022)", "iPad Pro 12.9 5th Gen M1 (2021)",
        "iPad Pro 12.9 4th Gen (2020)", "iPad Pro 12.9 3rd Gen (2018)",
        "iPad Pro 11 M4 (2024)", "iPad Pro 11 4th Gen M2 (2022)", "iPad Pro 11 3rd Gen M1 (2021)",
        "iPad Pro 11 2nd Gen (2020)", "iPad Pro 11 1st Gen (2018)"
      ],
      "iPad Air": [
        "iPad Air 13 7th Gen 'M3' (2025)", "iPad Air 11 7th Gen 'M3' (2025)",
        "iPad Air 13 M2 (2024)", "iPad Air 11 M2 (2024)",
        "iPad Air 5th Gen (2022)", "iPad Air 4th Gen (2020)"
      ],
      "iPad": [
        "iPad 11th Gen (2025)", "iPad 10th Gen (2022)", "iPad 9th Gen (2021)",
        "iPad 8th Gen (2020)", "iPad 7th Gen (2019)"
      ],
      "iPad Mini": [
        "iPad Mini 7 (2024)", "iPad Mini 6 (2021)", "iPad Mini 5 (2019)"
      ]
    },
    watch: [
      "Apple Watch Ultra 2", "Apple Watch Ultra",
      "Apple Watch Series 10 46MM", "Apple Watch Series 10 42MM",
      "Apple Watch Series 9 45MM", "Apple Watch Series 9 41MM",
      "Apple Watch Series 8 45MM", "Apple Watch Series 8 41MM",
      "Apple Watch SE 2nd Gen 44MM", "Apple Watch SE 2nd Gen 40MM",
      "Apple Watch Series 7 45MM", "Apple Watch Series 7 41MM",
      "Apple Watch Series 6 44MM", "Apple Watch Series 6 40MM",
      "Apple Watch Series 5 44MM", "Apple Watch Series 5 40MM",
      "Apple Watch SE 1st Gen 44MM", "Apple Watch SE 1st Gen 40MM"
    ]
  };

  /* ============================================ */
  /* DEVICE-SPECIFIC FAULT CATEGORIES             */
  /* ============================================ */
  /*
   * Each device gets its own fault list.
   * value = what gets submitted in the form
   * label = what the customer sees in the dropdown
   *
   * To add/remove/reorder faults, just edit here.
   */
  var FAULT_OPTIONS = {
    macbook: [
      { value: "Screen / Display",          label: "Screen / Display" },
      { value: "Power / Battery / Charging", label: "Power / Battery / Charging" },
      { value: "Trackpad / Keyboard",        label: "Trackpad / Keyboard" },
      { value: "Audio / Mic / Speaker",      label: "Audio / Microphone / Speaker" },
      { value: "Connectivity",               label: "Connectivity (WiFi / Bluetooth / Signal)" },
      { value: "Water Damage",               label: "Water Damage" },
      { value: "Data Recovery",              label: "Data Recovery" },
      { value: "Other",                      label: "Other" }
    ],
    iphone: [
      { value: "Screen / Display",          label: "Screen / Display" },
      { value: "Rear Glass",                label: "Rear Glass" },
      { value: "Camera",                    label: "Camera" },
      { value: "Power / Battery / Charging", label: "Power / Battery / Charging" },
      { value: "Audio / Mic / Speaker",      label: "Audio / Microphone / Speaker" },
      { value: "Connectivity",               label: "Connectivity (WiFi / Bluetooth / Signal)" },
      { value: "Water Damage",               label: "Water Damage" },
      { value: "Data Recovery",              label: "Data Recovery" },
      { value: "Other",                      label: "Other" }
    ],
    ipad: [
      { value: "Screen / Display",          label: "Screen / Display" },
      { value: "Power / Battery / Charging", label: "Power / Battery / Charging" },
      { value: "Audio / Mic / Speaker",      label: "Audio / Microphone / Speaker" },
      { value: "Connectivity",               label: "Connectivity (WiFi / Bluetooth / Signal)" },
      { value: "Water Damage",               label: "Water Damage" },
      { value: "Data Recovery",              label: "Data Recovery" },
      { value: "Other",                      label: "Other" }
    ],
    watch: [
      { value: "Screen / Display",          label: "Screen / Display" },
      { value: "Rear Glass",                label: "Rear Glass" },
      { value: "Power / Battery / Charging", label: "Power / Battery / Charging" },
      { value: "Connectivity",               label: "Connectivity (WiFi / Bluetooth)" },
      { value: "Water Damage",               label: "Water Damage" },
      { value: "Other",                      label: "Other" }
    ]
  };

  /* ============================================ */
  /* DYNAMIC SERVICE DETAILS CONFIG               */
  /* ============================================ */
  /*
   * turnaround:     always shown
   * express:        null = never shown, string = value text
   * expressFaults:  whitelist — express only for these faults
   * expressModelFn: function(model) → true/false
   *                 if set, model must ALSO pass this check
   *                 Used to restrict Express to M-series only
   */
  var SERVICE_CONFIG = {
    iphone: {
      turnaround: '2 hours (on average)',
      diagnosticFaults: ['Water Damage', 'Data Recovery', 'Other'],
      diagnosticTurnaround: '2-3 working days',
      express:    null,
      warranty:   '2-year warranty',
      parts:      'Genuine Apple parts',
      service:    'Walk-in, Collection & Delivery'
    },
    macbook: {
      turnaround: '2-3 working days',
      express:    'Same-day / next-day (pre-book required)',
      expressFaults: ['Screen / Display'],
      expressModelFn: function(model) {
        // Only M-series MacBooks get Express
        // M-series models always have 'M1' 'M2' 'M3' 'M4' etc in the name
        // Intel models: A2141, A1990, A1707, A2251, A2289, A2159, A1989, A2179, A1932
        return /[''\u2019]M[1-9]/.test(model);
      },
      warranty:   '2-year warranty',
      parts:      'Genuine Apple parts',
      service:    'Walk-in, Collection & Delivery'
    },
    ipad: {
      turnaround: '2-3 working days',
      express:    null,
      warranty:   '2-year warranty',
      parts:      'Genuine Apple parts',
      service:    'Walk-in, Collection & Delivery'
    },
    watch: {
      turnaround: '2-3 working days',
      express:    null,
      warranty:   '2-year warranty',
      parts:      'Genuine Apple parts',
      service:    'Walk-in, Collection & Delivery'
    }
  };

  var currentDeviceType = null;
  var detailsExpanded = true;

  /* ============================================ */
  /* UPDATE MODELS + FAULTS ON DEVICE SELECT      */
  /* ============================================ */
  function updateModels(selectedDevice) {
    currentDeviceType = selectedDevice;
    var modelSelect = document.getElementById('ContactForm-model');
    var faultSelect = document.getElementById('ContactForm-fault');

    // Reset both dropdowns
    modelSelect.innerHTML = '<option value="" disabled selected>Select Model...</option>';
    modelSelect.disabled = true;

    faultSelect.innerHTML = '<option value="" disabled selected>Select the main issue...</option>';
    faultSelect.disabled = true;

    hideSuggestion();

    if (!selectedDevice) return;

    // --- Populate MODELS ---
    if (repairData[selectedDevice]) {
      modelSelect.disabled = false;
      var data = repairData[selectedDevice];

      if (Array.isArray(data)) {
        data.forEach(function(model) {
          var option = document.createElement('option');
          option.value = model;
          option.textContent = model;
          modelSelect.appendChild(option);
        });
      } else {
        for (var groupName in data) {
          if (!data.hasOwnProperty(groupName)) continue;
          var optgroup = document.createElement('optgroup');
          optgroup.label = groupName;
          data[groupName].forEach(function(model) {
            var option = document.createElement('option');
            option.value = model;
            option.textContent = model;
            optgroup.appendChild(option);
          });
          modelSelect.appendChild(optgroup);
        }
      }
    }

    // --- Populate FAULTS ---
    if (FAULT_OPTIONS[selectedDevice]) {
      faultSelect.disabled = false;
      FAULT_OPTIONS[selectedDevice].forEach(function(f) {
        var option = document.createElement('option');
        option.value = f.value;
        option.textContent = f.label;
        faultSelect.appendChild(option);
      });
    }
  }

  /* ============================================ */
  /* COLLECTION MAPPING                           */
  /* ============================================ */
  var COLLECTION_MAP = {
    "MacBook Pro 16-inch 'M4 Pro/Max' A3186/A3403 (2024)": "macbook-pro-16-m4-pro-a3403-2024-repair-prices",
    "MacBook Pro 16-inch 'M3 Pro/Max' A2991 (2023)": "macbook-pro-16-m3-pro-max-a2991-2023-repair-prices",
    "MacBook Pro 16-inch 'M2 Pro/Max' A2780 (2023)": "macbook-pro-16-m2-pro-max-a2780-2023-repair-prices",
    "MacBook Pro 16-inch 'M1 Pro/Max' A2485 (2021)": "macbook-pro-16-m1-pro-max-a2485-2021-repair-prices",
    "MacBook Pro 16-inch A2141 (2019)": "macbook-pro-16-a2141-2019-repair-prices",
    "MacBook Pro 15-inch A1990 (2018-2019)": "macbook-pro-15-a1990-2018-2019-repair-prices",
    "MacBook Pro 15-inch A1707 (2016-2017)": "macbook-pro-15-retina-a1707-2016-2017-repair-prices",
    "MacBook Pro 14-inch 'M4 Pro/Max' A3112/A3185/A3401 (2024)": "macbook-pro-14-m4-pro-a3401-2024-repair-prices",
    "MacBook Pro 14-inch 'M3 Pro/Max' A2918/A2992 (2023)": "macbook-pro-14-m3-m3-pro-max-a2918-a2992-2023-repair-prices",
    "MacBook Pro 14-inch 'M2 Pro/Max' A2779 (2023)": "macbook-pro-14-m2-pro-max-a2779-2023-repair-prices",
    "MacBook Pro 14-inch 'M1 Pro/Max' A2442 (2021)": "macbook-pro-14-m1-pro-max-a2442-2021-repair-prices",
    "MacBook Pro 13-inch 'M2' A2338 (2022)": "macbook-pro-13-m2-a2338-2022-repair-prices",
    "MacBook Pro 13-inch 'M1' A2338 (2020)": "macbook-pro-13-m1-a2338-2020-repair-prices",
    "MacBook Pro 13-inch A2251 (2020)": "macbook-pro-13-4tb-3-a2251-2020-repair-prices",
    "MacBook Pro 13-inch A2289 (2020)": "macbook-pro-13-2tb-3-a2289-2020-repair-prices",
    "MacBook Pro 13-inch A2159 (2019)": "macbook-pro-13-2tb-3-a2159-2019-repair-prices",
    "MacBook Pro 13-inch A1989 (2018-2019)": "macbook-pro-13-touch-bar-a1989-2018-2019-repair-prices",
    "MacBook Air 15-inch 'M4' A3241 (2025)": "macbook-air-15-m4-a3241-2025-repair-prices",
    "MacBook Air 15-inch 'M3' A3114 (2024)": "macbook-air-15-m3-a3114-2024-repair-prices",
    "MacBook Air 15-inch 'M2' A2941 (2023)": "macbook-air-15-m2-a2941-2023-repair-prices",
    "MacBook Air 13-inch 'M4' A3240 (2025)": "macbook-air-13-m4-a3240-2025-repair-prices",
    "MacBook Air 13-inch 'M3' A3113 (2024)": "macbook-air-13-m3-a3113-2024-repair-prices",
    "MacBook Air 13-inch 'M2' A2681 (2022)": "macbook-air-13-m2-a2681-2022-repair-prices",
    "MacBook Air 13-inch 'M1' A2337 (2020)": "macbook-air-13-m1-a2337-2020-repair-prices",
    "MacBook Air 13-inch A2179 (2020)": "macbook-air-13-a2179-2020-repair-prices",
    "MacBook Air 13-inch A1932 (2018-2019)": "macbook-air-13-a1932-2018-2019-repair-prices",
    "iPhone 16 Pro Max": "iphone-16-pro-max-repair-prices",
    "iPhone 16 Pro": "iphone-16-pro-repair-prices",
    "iPhone 16 Plus": "iphone-16-plus-repair-prices",
    "iPhone 16": "iphone-16-repair-prices",
    "iPhone 16e": "iphone-16e-repair-prices",
    "iPhone 15 Pro Max": "iphone-15-pro-max-repair-prices",
    "iPhone 15 Pro": "iphone-15-pro-repair-prices",
    "iPhone 15 Plus": "iphone-15-plus-repair-prices",
    "iPhone 15": "iphone-15-repair-prices",
    "iPhone 14 Pro Max": "iphone-14-pro-max-repair-prices",
    "iPhone 14 Pro": "iphone-14-pro-repair-prices",
    "iPhone 14 Plus": "iphone-14-plus-repair-prices",
    "iPhone 14": "iphone-14-repair-prices",
    "iPhone SE 3rd Gen (2022)": "iphone-se-3rd-gen-repair-prices",
    "iPhone 13 Pro Max": "iphone-13-pro-max-repair-prices",
    "iPhone 13 Pro": "iphone-13-pro-repair-prices",
    "iPhone 13": "iphone-13-repair-prices",
    "iPhone 13 Mini": "iphone-13-mini-repair-prices",
    "iPhone 12 Pro Max": "iphone-12-pro-max-repair-prices",
    "iPhone 12 Pro": "iphone-12-pro-repair-prices",
    "iPhone 12": "iphone-12-repair-prices",
    "iPhone 12 Mini": "iphone-12-mini-repair-prices",
    "iPhone SE 2nd Gen (2020)": "iphone-se-2nd-gen-repair-prices",
    "iPhone 11 Pro Max": "iphone-11-pro-max-repair-prices",
    "iPhone 11 Pro": "iphone-11-pro-repair-prices",
    "iPhone 11": "iphone-11-repair-prices",
    "iPad Pro 13 M4 (2024)": "ipad-pro-13-7th-gen-m4-a2925-a2926-2024-repair-prices",
    "iPad Pro 12.9 6th Gen M2 (2022)": "ipad-pro-12-9-6th-gen-m2-a2436-a2764-2022-repair-prices",
    "iPad Pro 12.9 5th Gen M1 (2021)": "ipad-pro-12-9-5th-gen-m1-a2378-a2461-2021-repair-prices",
    "iPad Pro 12.9 4th Gen (2020)": "ipad-pro-12-9-4th-gen-m1-a2229-a2069-a2232-2020-repair-prices",
    "iPad Pro 12.9 3rd Gen (2018)": "ipad-pro-12-9-3rd-gen-a1876-a2014-a1895-2018-repair-prices",
    "iPad Pro 11 M4 (2024)": "ipad-pro-11-5th-gen-m4-a2836-a2837-2024-repair-prices",
    "iPad Pro 11 4th Gen M2 (2022)": "ipad-pro-11-4th-gen-m2-a2759-a2435-2022-repair-prices",
    "iPad Pro 11 3rd Gen M1 (2021)": "ipad-pro-11-3rd-gen-m1-a2377-a2459-2021-repair-prices",
    "iPad Pro 11 2nd Gen (2020)": "ipad-pro-11-2nd-gen-a2228-a2068-a2230-2020-repair-prices",
    "iPad Pro 11 1st Gen (2018)": "ipad-pro-11-a1980-a2013-a1934-2019-repair-prices",
    "iPad Air 13 7th Gen 'M3' (2025)": "ipad-air-13-7th-gen-m3-2025-repair-prices",
    "iPad Air 11 7th Gen 'M3' (2025)": "ipad-air-11-7th-gen-m3-2025-repair-prices",
    "iPad Air 13 M2 (2024)": "ipad-air-13-6th-gen-m2-a2898-a2903-2024-repair-prices",
    "iPad Air 11 M2 (2024)": "ipad-air-11-6th-gen-m2-a2899-a2902-2024-repair-prices",
    "iPad Air 5th Gen (2022)": "ipad-air-5th-gen-a2588-a2589-a2591-2022-repair-prices",
    "iPad Air 4th Gen (2020)": "ipad-air-4th-gen-repair-prices",
    "iPad 11th Gen (2025)": "ipad-11th-gen-2025-repair-prices",
    "iPad 10th Gen (2022)": "ipad-10th-gen-a2696-a2757-2022-repair-prices",
    "iPad 9th Gen (2021)": "ipad-9th-gen-a2602-a2604-2021-repair-prices",
    "iPad 8th Gen (2020)": "ipad-8th-gen-a2270-a2428-a2429-a2430-2020-repair-prices",
    "iPad 7th Gen (2019)": "ipad-7th-gen-a2197-a2200-a2198-2019-repair-prices",
    "iPad Mini 7 (2024)": "ipad-mini-7th-gen-2024-repair-prices",
    "iPad Mini 6 (2021)": "ipad-mini-6th-gen-a2567-a2568-2021-repair-prices",
    "iPad Mini 5 (2019)": "ipad-mini-5th-gen-a2133-a2124-a2126-2019-repair-prices",
    "Apple Watch Ultra 2": "apple-watch-ultra-2-repair-prices",
    "Apple Watch Ultra": "apple-watch-ultra-repair-prices",
    "Apple Watch Series 10 46MM": "apple-watch-series-10-repair-prices",
    "Apple Watch Series 10 42MM": "apple-watch-series-10-repair-prices",
    "Apple Watch Series 9 45MM": "apple-watch-series-9-45mm-repair-prices",
    "Apple Watch Series 9 41MM": "apple-watch-series-9-41mm-repair-prices",
    "Apple Watch Series 8 45MM": "apple-watch-series-8-45mm-repair-prices",
    "Apple Watch Series 8 41MM": "apple-watch-series-8-41mm-repair-prices",
    "Apple Watch SE 2nd Gen 44MM": "apple-watch-se-2-44mm-repair-prices",
    "Apple Watch SE 2nd Gen 40MM": "apple-watch-se-2-40mm-repair-prices",
    "Apple Watch SE 1st Gen 44MM": "apple-watch-se-44mm-repair-prices",
    "Apple Watch SE 1st Gen 40MM": "apple-watch-se-40mm-repair-prices",
    "Apple Watch Series 7 45MM": "apple-watch-series-7-45mm-repair-prices",
    "Apple Watch Series 7 41MM": "apple-watch-series-7-41mm-repair-prices",
    "Apple Watch Series 6 44MM": "apple-watch-series-6-44mm-repair-prices",
    "Apple Watch Series 6 40MM": "apple-watch-series-6-40mm-repair-prices",
    "Apple Watch Series 5 44MM": "apple-watch-series-5-44mm-repair-prices",
    "Apple Watch Series 5 40MM": "apple-watch-series-5-40mm-repair-prices"
  };

  /* ============================================ */
  /* SUGGESTION CARD FUNCTIONS                   */
  /* ============================================ */
  function getFaultIcon(fault) {
    var icons = {
      'Screen / Display': '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><rect x="2" y="3" width="20" height="14" rx="2"/><path d="M8 21h8M12 17v4"/></svg>',
      'Rear Glass': '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><rect x="5" y="2" width="14" height="20" rx="2"/><circle cx="12" cy="6" r="1.5"/><path d="M10 18h4"/></svg>',
      'Camera': '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M23 19a2 2 0 01-2 2H3a2 2 0 01-2-2V8a2 2 0 012-2h4l2-3h6l2 3h4a2 2 0 012 2z"/><circle cx="12" cy="13" r="4"/></svg>',
      'Power / Battery / Charging': '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"/></svg>',
      'Trackpad / Keyboard': '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><rect x="2" y="4" width="20" height="16" rx="2"/><path d="M6 8h.01M10 8h.01M14 8h.01M18 8h.01M6 12h.01M10 12h.01M14 12h.01M18 12h.01M8 16h8"/></svg>',
      'Audio / Mic / Speaker': '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M12 1a3 3 0 00-3 3v8a3 3 0 006 0V4a3 3 0 00-3-3z"/><path d="M19 10v2a7 7 0 01-14 0v-2M12 19v4M8 23h8"/></svg>',
      'Connectivity': '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M5 12.55a11 11 0 0114.08 0M1.42 9a16 16 0 0121.16 0M8.53 16.11a6 6 0 016.95 0M12 20h.01"/></svg>',
      'Water Damage': '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M12 2.69l5.66 5.66a8 8 0 11-11.31 0z"/></svg>',
      'Data Recovery': '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4M7 10l5 5 5-5M12 15V3"/></svg>',
      'Other': '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M14.7 6.3a1 1 0 000 1.4l1.6 1.6a1 1 0 001.4 0l3.77-3.77a6 6 0 01-7.94 7.94l-6.91 6.91a2.12 2.12 0 01-3-3l6.91-6.91a6 6 0 017.94-7.94l-3.76 3.76z"/></svg>'
    };
    return icons[fault] || icons['Other'];
  }

  function getFaultLabel(fault) {
    var labels = {
      'Screen / Display': 'Screen & Display Repairs',
      'Rear Glass': 'Rear Glass Repairs',
      'Camera': 'Camera Repairs',
      'Power / Battery / Charging': 'Battery & Charging Repairs',
      'Trackpad / Keyboard': 'Trackpad & Keyboard Repairs',
      'Audio / Mic / Speaker': 'Audio & Speaker Repairs',
      'Connectivity': 'Connectivity Repairs',
      'Water Damage': 'Water Damage Repairs',
      'Data Recovery': 'Data Recovery',
      'Other': 'All Repairs'
    };
    return labels[fault] || 'Repairs';
  }

  /* SVG icons for service detail rows */
  var SERVICE_ICONS = {
    warranty:   '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>',
    turnaround: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M12 6v6l4 2"/></svg>',
    express:    '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"/></svg>',
    parts:      '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"/></svg>',
    service:    '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/><path d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"/></svg>'
  };

  /** Build one service row */
  function serviceRow(iconKey, label, value) {
    return '<div class="service-row">' +
      '<div class="service-row-icon">' + SERVICE_ICONS[iconKey] + '</div>' +
      '<span class="service-row-label">' + label + '</span>' +
      '<span class="service-row-value">' + value + '</span>' +
    '</div>';
  }

  /**
   * Build all service rows dynamically.
   * Express requires ALL conditions to pass:
   *   1. cfg.express is not null
   *   2. Fault is in cfg.expressFaults (if defined)
   *   3. Model passes cfg.expressModelFn (if defined)
   */
  function buildServiceRows(deviceType, fault, model) {
    var cfg = SERVICE_CONFIG[deviceType] || SERVICE_CONFIG.macbook;
    var rows = '';

    rows += serviceRow('warranty', 'Warranty', cfg.warranty);

    // Turnaround: use diagnostic override if fault matches
    var turnaround = cfg.turnaround;
    if (cfg.diagnosticFaults && cfg.diagnosticFaults.indexOf(fault) !== -1) {
      turnaround = cfg.diagnosticTurnaround || cfg.turnaround;
    }
    rows += serviceRow('turnaround', 'Turnaround', turnaround);

    // Express: triple gate
    if (cfg.express) {
      var faultOk = !cfg.expressFaults || cfg.expressFaults.indexOf(fault) !== -1;
      var modelOk = !cfg.expressModelFn || cfg.expressModelFn(model);
      if (faultOk && modelOk) {
        rows += serviceRow('express', 'Express', cfg.express);
      }
    }

    rows += serviceRow('parts', 'Parts', cfg.parts);
    rows += serviceRow('service', 'Service', cfg.service);

    return rows;
  }

  function updateSuggestion() {
    var model = document.getElementById('ContactForm-model').value;
    var fault = document.getElementById('ContactForm-fault').value;

    if (!model || !fault || !currentDeviceType) {
      hideSuggestion();
      return;
    }
    showSuggestion(model, fault);
  }

  function showSuggestion(model, fault) {
    var container = document.getElementById('repairSuggestion');
    var handle = COLLECTION_MAP[model];

    if (!handle) {
      hideSuggestion();
      return;
    }

    var url = '/collections/' + handle;
    var faultIcon = getFaultIcon(fault);
    var faultLabel = getFaultLabel(fault);
    var serviceRows = buildServiceRows(currentDeviceType, fault, model);

    container.innerHTML =
      '<div class="suggestion-card">' +
        '<div class="suggestion-header">' +
          '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M12 16v-4M12 8h.01"/></svg>' +
          '<span class="suggestion-header-text">We have pricing for this repair</span>' +
        '</div>' +
        '<a href="' + url + '" target="_blank" rel="noopener" class="suggestion-link">' +
          '<div class="suggestion-icon-wrap">' + faultIcon + '</div>' +
          '<div class="suggestion-body">' +
            '<div class="suggestion-title">' + faultLabel + '</div>' +
            '<div class="suggestion-meta">View all repair options & pricing for this model</div>' +
          '</div>' +
          '<svg class="suggestion-arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M5 12h14M12 5l7 7-7 7"/></svg>' +
        '</a>' +
        '<button type="button" class="service-toggle ' + (detailsExpanded ? '' : 'collapsed') + '" onclick="toggleDetails(this)">' +
          '<span>' + (detailsExpanded ? 'Hide Details' : 'Service Details') + '</span>' +
          '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 15l-6-6-6 6"/></svg>' +
        '</button>' +
        '<div class="service-content ' + (detailsExpanded ? '' : 'hidden') + '">' +
          serviceRows +
        '</div>' +
      '</div>';

    requestAnimationFrame(function() { container.classList.add('visible'); });
  }

  function hideSuggestion() {
    var container = document.getElementById('repairSuggestion');
    container.classList.remove('visible');
    setTimeout(function() { container.innerHTML = ''; }, 400);
  }

  function toggleDetails(btn) {
    detailsExpanded = !detailsExpanded;
    btn.classList.toggle('collapsed');
    btn.querySelector('span').textContent = detailsExpanded ? 'Hide Details' : 'Service Details';
    btn.nextElementSibling.classList.toggle('hidden');
  }
</script>

{% schema %}
{
  "name": "Enhanced Contact Form",
  "tag": "section",
  "class": "section",
  "settings": [
    {
      "type": "header",
      "content": "Map Settings"
    },
    {
      "type": "html",
      "id": "map_html",
      "label": "Google Maps Embed Code",
      "default": "<iframe src='https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d2482.7925117760165!2d-0.1422392230845079!3d51.51702250999988!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x48761b2c5aabf83b%3A0x2abbd489a9d66382!2siCorrect!5e0!3m2!1sen!2sit!4v1766495755523!5m2!1sen!2sit' width='600' height='450' style='border:0;' allowfullscreen='' loading='lazy' referrerpolicy='no-referrer-when-downgrade'></iframe>"
    },
    {
      "type": "header",
      "content": "Left Panel Details"
    },
    {
      "type": "textarea",
      "id": "address",
      "label": "Address (Vertical)",
      "default": "iCorrect\n12 Margaret Street\nAudley House\nLondon\nW1W 8JQ"
    },
    {
      "type": "header",
      "content": "Form Text (Right Panel)"
    },
    {
      "type": "text",
      "id": "form_heading",
      "label": "Form Heading",
      "default": "Get Your Free Quote!"
    },
    {
      "type": "textarea",
      "id": "form_subtitle",
      "label": "Form Subtitle",
      "default": "Have a question about your device repair? We're here to help."
    },
    {
      "type": "header",
      "content": "Colors"
    },
    {
      "type": "color",
      "id": "section_bg",
      "label": "Section Background",
      "default": "#f4f4f4"
    },
    {
      "type": "color",
      "id": "accent_color",
      "label": "Accent Color",
      "default": "#3b82f6"
    },
    {
      "type": "color",
      "id": "text_color",
      "label": "Text Color",
      "default": "#171717"
    },
    {
      "type": "color",
      "id": "muted_text_color",
      "label": "Muted Text Color",
      "default": "#6b7280"
    },
    {
      "type": "color",
      "id": "input_bg",
      "label": "Input BG",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "input_border",
      "label": "Input Border",
      "default": "#e5e7eb"
    }
  ],
  "presets": [
    {
      "name": "Contact with map"
    }
  ]
}
{% endschema %}
