{% comment %}
  PostHog Custom Event Tracking
  - Checkout Started: fires when user clicks checkout button
  - Add to Cart: fires when product added to cart
{% endcomment %}

<script>
document.addEventListener('DOMContentLoaded', function() {
  // Wait for PostHog to be ready
  if (typeof posthog === 'undefined') return;
  
  // Track Checkout Started - capture before redirect to Shopify checkout
  document.addEventListener('click', function(e) {
    var target = e.target.closest('[name="checkout"], [type="submit"][name="checkout"], a[href*="/checkout"], button.checkout-button, .cart__checkout-button, [data-checkout-button]');
    if (target) {
      posthog.capture('Checkout Started', {
        cart_url: window.location.href,
        timestamp: new Date().toISOString()
      });
    }
  }, true);
  
  // Track Add to Cart
  document.addEventListener('click', function(e) {
    var target = e.target.closest('[type="submit"][name="add"], .product-form__submit, .add-to-cart-button, button[data-add-to-cart]');
    if (target) {
      var form = target.closest('form');
      var productTitle = document.querySelector('.product__title, h1.title')?.textContent?.trim() || 'Unknown';
      var price = document.querySelector('.price-item--regular, .product__price')?.textContent?.trim() || '0';
      
      posthog.capture('Add to Cart', {
        product_name: productTitle,
        price: price,
        url: window.location.href
      });
    }
  }, true);
  
  // Track Product Viewed (on product pages)
  if (window.location.pathname.includes('/products/')) {
    var productTitle = document.querySelector('.product__title, h1.title')?.textContent?.trim() || 'Unknown';
    var price = document.querySelector('.price-item--regular, .product__price')?.textContent?.trim() || '0';
    
    posthog.capture('Product Viewed', {
      product_name: productTitle,
      price: price,
      url: window.location.href
    });
  }
  
  // Track Collection Viewed (on collection pages)
  if (window.location.pathname.includes('/collections/')) {
    var collectionTitle = document.querySelector('.collection-hero__title, h1')?.textContent?.trim() || 'Unknown';
    
    posthog.capture('Collection Viewed', {
      collection_name: collectionTitle,
      url: window.location.href
    });
  }
});
</script>
